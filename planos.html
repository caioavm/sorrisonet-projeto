<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Planos ‚Äî SorrisoNet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- TOPO -->
  <header class="topbar">
    <div class="topbar-inner">
      <a class="brand" href="index.html">
        <img src="logotipo_sorriso_net_azul_claro-removebg-preview.png" alt="SorrisoNet">
      </a>

      <button class="btn-primary" onclick="location.href='assinatura.html'">ASSINE J√Å</button>

      <div class="search">
        <input type="search" placeholder="Digite sua pesquisa" />
      </div>

      <nav class="main-nav">
        <a href="area-assinante.html">√ÅREA DO ASSINANTE</a>
        <a href="planos.html">PLANOS</a>
        <a href="agenda_doutores.html">GERENCIAMENTO</a>
        <a href="contato.html">FALE CONOSCO</a>
        <a id="btnLoginLogout" href="login.html">Login</a>
      </nav>
    </div>
  </header>

  <!-- CONTE√öDO ESPEC√çFICO -->
  <main class="container" style="padding:48px 0">
    <h1 style="text-align:center; margin-bottom:40px;">
      Escolha o plano ideal para voc√™
    </h1>

    <section class="planos-grid">

      <!-- PLANO B√ÅSICO -->
      <div class="plano-card">
       <h2>Plano B√°sico - Dentista Solo</h2>
        <p>Profissionais independentes que precisam de organiza√ß√£o e ferramentas b√°sicas.</p>
        <ul>
          <li>‚úî Agenda online integrada</li>
          <li>‚úî Hist√≥rico cl√≠nico simples</li>
          <li>‚úî Cadastro de pacientes</li>
        </ul>
        <p class="preco">R$ 99/m√™s</p>
        <button
          data-assinar="Basico"
          class="btn-assinar"
        >
          Assinar
        </button>
      </div>

      <!-- PLANO PREMIUM -->
      <div class="plano-card destaque">
       <h2>Plano Premium - Consult√≥rio </h2>
        <p>Ideal para dentistas j√° estruturados que precisam de mais controle.</p>
        <ul>
          <li>‚úî Todas as vantagens do Plano B√°sico</li>
          <li>‚úî Relat√≥rios financeiros mensais</li>
          <li>‚úî Emiss√£o de recibos e documentos</li>
        </ul>
        <p class="preco">R$ 149/m√™s</p>
        <button
          data-assinar="Premium"
          class="btn-assinar"
        >
          Assinar
        </button>
      </div>

      <!-- PLANO CL√çNICA -->
      <div class="plano-card">
        <h2>Plano Cl√≠nica - Equipe / M√∫ltiplos dentistas</h2>
        <p>Para cl√≠nicas com v√°rios profissionais e fluxo mais complexo.</p>
        <ul>
          <li>‚úî Todos os recursos do Plano Profissional</li>
          <li>‚úî Controle avan√ßado de estoque</li>
          <li>‚úî Dashboard de produ√ß√£o por profissional</li>
        </ul>
        <p class="preco">R$ 249/m√™s</p>
        <button
          data-assinar="Familia"
          class="btn-assinar"
        >
          Assinar
        </button>
      </div>
    </section>

    <!-- mensagem opcional -->
    <p id="statusAssinatura"
       style="text-align:center; margin-top:24px; font-size:14px; color:#555;">
    </p>
  </main>

  <!-- RODAP√â -->
  <footer class="site-footer">
    <div class="container">
      <p>¬© SorrisoNet ‚Äî Trabalho acad√™mico</p>
    </div>
  </footer>

  <!-- scripts -->
 <script src="js/api.js"></script>
<script src="js/auth.js"></script>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const msgStatus      = document.getElementById('statusAssinatura'); // o <p> verde no meio da p√°gina
  const btnAssineJa    = document.querySelector('.btn-primary');      // bot√£o azul grande "ASSINE J√Å" no topo
  const btnLoginLogout = document.getElementById('btnLoginLogout');   // link "Login" no topo

  // essa fun√ß√£o deixa o header correto
  function aplicarHeaderLogado() {
    if (!btnLoginLogout) return;
    btnLoginLogout.textContent = 'Sair';
    btnLoginLogout.href = '#';
    btnLoginLogout.onclick = () => {
      logout(); // vem do auth.js
    };
  }

  function aplicarHeaderDeslogado() {
    if (!btnLoginLogout) return;
    btnLoginLogout.textContent = 'Login';
    btnLoginLogout.href = 'login.html';
    btnLoginLogout.onclick = null;
  }

  // tenta descobrir quem √© o usu√°rio logado
  let me = null;
  try {
    // tenta chamar /api/me mandando token manualmente
    // (n√£o uso requireLogin aqui porque em "planos" a pessoa pode estar deslogada e tudo bem)
    const resp = await fetch('http://localhost:3000/api/me', {
      headers: {
        Authorization: 'Bearer ' + localStorage.getItem('token')
      }
    });

    if (resp.ok) {
      me = await resp.json(); // {id, nome, email, premium: true/false, ...}
    }
  } catch (err) {
    console.warn('N√£o consegui buscar /api/me (talvez sem login ainda):', err);
  }

  // agora decidimos o que mostrar com base nisso:

  if (me) {
    // usu√°rio LOGADO
    aplicarHeaderLogado(); // troca "Login" -> "Sair"

    if (me.premium === true) {
      // j√° √© premium
      if (msgStatus) {
        msgStatus.textContent = 'Voc√™ j√° √© Premium üòé';
        msgStatus.style.color = 'green';
        msgStatus.style.fontWeight = '600';
        msgStatus.style.textAlign = 'center';
      }

      // esconde bot√£o ASSINE J√Å do topo
      if (btnAssineJa) {
        btnAssineJa.style.display = 'none';
      }
    } else {
      // logado mas N√ÉO premium ainda
      // mostra o bot√£o ASSINE J√Å (ele pode assinar)
      if (btnAssineJa) {
        btnAssineJa.style.display = '';
      }
      if (msgStatus) {
        msgStatus.textContent = ''; // n√£o mostra nada aqui
      }
    }

  } else {
    // usu√°rio N√ÉO LOGADO
    aplicarHeaderDeslogado(); // deixa "Login"
    // mant√©m "ASSINE J√Å" vis√≠vel porque queremos incentivar ele a assinar depois que logar
    if (btnAssineJa) {
        btnAssineJa.style.display = '';
    }
    if (msgStatus) {
      msgStatus.textContent = ''; // nada
    }
  }

  // agora vamos ligar os bot√µes "Assinar" de cada plano:
  const botoesPlanos = document.querySelectorAll('[data-assinar]');
  botoesPlanos.forEach(btn => {
    btn.addEventListener('click', () => {
      // rota: se n√£o tem login -> manda pro login
      if (!localStorage.getItem('token')) {
        alert('Fa√ßa login para continuar sua assinatura.');
        window.location.href = 'login.html';
        return;
      }

      // tem login -> manda pra tela de checkout (assinatura.html)
      // se voc√™ quiser passar qual plano clicou, podemos mandar via querystring:
      // assinatura.html?plano=Premium, por exemplo:
      const planoName = btn.getAttribute('data-assinar') || '';
      window.location.href = 'assinatura.html?plano=' + encodeURIComponent(planoName);
    });
  });
});
</script>
</body>
</html>
 
